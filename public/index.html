<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="https://fonts.googleapis.com/css2?family=Monoton&display=swap" rel="stylesheet">
<title>Rate the Concert üéµ</title>

<style>
  :root {
    --bg: #0f1724;
    --card: #0b1220;
    --accent: #ff6b6b;
    --muted: #9aa4b2;
  }

  * { box-sizing: border-box; }

  body {
    margin: 0;
    min-height: 100vh;
    font-family: Inter, system-ui, sans-serif;
    background: linear-gradient(180deg, #071027 0%, #081226 50%, #08121b 100%);
    color: #e6eef6;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px;
  }

  /* ===== LOGO ===== */
  .top-left-logo {
  position: fixed;
  top: 20px;
  left: 20px;
  width: 160px; /* larger for visibility */
  height: auto;
  z-index: 1000;
  background: #ffffff10; /* soft contrast patch */
  border-radius: 8px;
  padding: 8px;
  backdrop-filter: blur(8px);
  box-shadow: 0 0 12px rgba(255, 255, 255, 0.1);
  opacity: 1;
  transition: all 0.3s ease;
}

  .top-left-logo:hover {
  transform: scale(1.05);
  box-shadow: 0 0 20px rgba(255, 255, 255, 0.25);
}

@media (max-width: 600px) {
  .top-left-logo {
    width: 120px;
    top: 12px;
    left: 12px;
    padding: 6px;
  }
}
/* ===== Top Logo Bar ===== */
.logo-bar {
  position: fixed;
  top: 120px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  gap: 14px;
  z-index: 1000;
}

/* Adjust the logo image */
.top-left-logo {
  width: 70px;
  height: auto;
  border-radius: 8px;
  box-shadow: 0 0 12px rgba(255, 255, 255, 0.2);
}

/* Neon text beside logo ‚Äî soft glow + dark outline */
.neon-text {
  font-family: "Comic Sans MS","Comic Sans", cursive;
  font-size: 54px;
  font-weight: 800;
  color: #fff27a;
  letter-spacing: 1px;

  /* Dark outline for clarity */
  -webkit-text-stroke: 1px rgba(0, 0, 0, 0.8);
  text-shadow:
    0 0 2px rgba(0, 0, 0, 0.8),  /* inner dark halo to reduce smudge */
    0 0 4px #fff27a,
    0 0 8px #ffe76b,
    0 0 12px #ffd84d,
    0 0 18px #ffec8b;

  animation: gentleGlow 6s infinite ease-in-out;
  transition: text-shadow 0.5s ease;
}

/* Smooth, slow glow animation */
@keyframes gentleGlow {
  0%, 100% {
    text-shadow:
      0 0 2px rgba(0, 0, 0, 0.8),
      0 0 6px #fff27a,
      0 0 10px #ffe76b,
      0 0 18px #ffd84d,
      0 0 24px #ffec8b;
    opacity: 1;
  }
  50% {
    text-shadow:
      0 0 2px rgba(0, 0, 0, 0.8),
      0 0 4px #fff27a,
      0 0 8px #ffe76b,
      0 0 14px #ffd84d;
    opacity: 0.9;
  }
}

/* Responsive scaling */
@media (max-width: 600px) {
  .neon-text {
    font-size: 22px;
    -webkit-text-stroke: 0.6px rgba(0, 0, 0, 0.8);
  }
  .top-left-logo {
    width: 50px;
  }
}



  /* ===== CARD ===== */
  .card {
    width: 100%;
    max-width: 720px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius: 14px;
    padding: 22px;
    box-shadow: 0 8px 30px rgba(2,6,23,0.6);
    border: 1px solid rgba(255,255,255,0.03);
  }

  header { display: flex; gap: 12px; align-items: center; }
  .logo {
    width: 56px; height: 56px; border-radius: 10px;
    background: linear-gradient(135deg, var(--accent), #ff9a9a);
    display: flex; align-items: center; justify-content: center;
    font-weight: 700; color: #071220; font-size: 18px;
  }
  h1 { margin: 0; font-size: 20px; }
  p.lead { margin: 6px 0 18px; color: var(--muted); }

  .slider-wrap { display: flex; align-items: center; gap: 16px; }
  input[type="range"] {
    flex: 1;
    -webkit-appearance: none;
    height: 6px;
    border-radius: 6px;
    background: linear-gradient(90deg, var(--accent), #ffb3b3);
    outline: none;
  }
  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 40px; height: 40px; border-radius: 50%;
    background: white;
    box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    border: 6px solid rgba(255,255,255,0.9);
  }

  /* ===== PEACH RATING ===== */
  .rating-bubble {
    position: relative;
    width: 64px;
    height: 64px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: transform 0.2s ease, box-shadow 0.4s ease;
  }

  .peach {
    font-size: 54px;
    line-height: 1;
    transition: filter 0.4s ease;
  }

  .rating-count {
    position: absolute;
    top: 55%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-weight: 800;
    font-size: 20px;
    color: #3a0b00;
    text-shadow: 0 0 4px rgba(255,255,255,0.8);
    pointer-events: none;
  }

  /* ===== GLOW EFFECTS (1‚Äì10) ===== */
  .glow-1  { box-shadow: 0 0 8px rgba(255, 60, 60, 0.3);  filter: drop-shadow(0 0 6px rgba(255, 60, 60, 0.4)); }
  .glow-2  { box-shadow: 0 0 10px rgba(255, 90, 60, 0.4); filter: drop-shadow(0 0 8px rgba(255, 90, 60, 0.5)); }
  .glow-3  { box-shadow: 0 0 12px rgba(255, 120, 70, 0.5); filter: drop-shadow(0 0 10px rgba(255, 120, 70, 0.6)); }
  .glow-4  { box-shadow: 0 0 14px rgba(255, 140, 70, 0.6); filter: drop-shadow(0 0 12px rgba(255, 140, 70, 0.7)); }
  .glow-5  { box-shadow: 0 0 16px rgba(255, 160, 80, 0.7); filter: drop-shadow(0 0 14px rgba(255, 160, 80, 0.8)); }
  .glow-6  { box-shadow: 0 0 18px rgba(255, 180, 100, 0.8); filter: drop-shadow(0 0 15px rgba(255, 180, 100, 0.9)); }
  .glow-7  { box-shadow: 0 0 20px rgba(255, 200, 120, 0.9); filter: drop-shadow(0 0 16px rgba(255, 200, 120, 1)); }
  .glow-8  { box-shadow: 0 0 24px rgba(255, 220, 140, 1);   filter: drop-shadow(0 0 18px rgba(255, 220, 140, 1)); }
  .glow-9  { box-shadow: 0 0 26px rgba(255, 235, 160, 1);   filter: drop-shadow(0 0 20px rgba(255, 235, 160, 1)); }
  .glow-10 { box-shadow: 0 0 30px rgba(255, 255, 180, 1);   filter: drop-shadow(0 0 24px rgba(255, 255, 180, 1)); }

  @keyframes pop {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.15); }
  }
  .peach.pop { animation: pop 0.4s ease; }

  /* ===== BUTTONS ===== */
  .controls { display: flex; gap: 12px; margin-top: 16px; flex-wrap: wrap; }
  button {
    padding: 10px 18px;
    border-radius: 10px;
    border: none;
    font-weight: 700;
    cursor: pointer;
    transition: background 0.3s ease, transform 0.2s ease;
  }
  button:hover { transform: translateY(-2px); }
  button.primary {
    background: linear-gradient(180deg, var(--accent), #ff8a8a);
    color: #071220;
  }
  button.secondary {
    background: transparent;
    border: 1px solid rgba(255,255,255,0.1);
    color: var(--muted);
  }

  .muted { color: var(--muted); font-size: 14px; margin-top: 12px; }

  .modal {
    position: fixed;
    left: 50%; top: 50%;
    transform: translate(-50%, -50%);
    background: #081224;
    padding: 18px;
    border-radius: 12px;
    text-align: center;
    border: 1px solid rgba(255,255,255,0.1);
    display: none;
  }
</style>
</head>

<body>
  <!-- Top-left Logo -->
  <img src="/images/logo.png" alt="Nonsane-sible logo" class="top-left-logo" />
  <!-- Top logo area -->
    <div class="logo-bar">
        <h1 class="neon-text">NONSANE-sible</h1>
    </div>


  <div class="card">
    <header>
      <div class="logo">üéµ</div>
      <div>
        <h1>Juicy Points üí¶ </h1>
        <p class="lead">Slide to pick a rating from 1 to 10. Quick and anonymous.</p>
      </div>
    </header>

    <div style="margin-top: 18px;">
      <div class="slider-wrap">
        <input id="slider" type="range" min="1" max="10" value="8" step="1" aria-label="Rating slider">
        <div class="rating-bubble" id="bubble">
          <span class="peach">üçë</span>
          <span class="rating-count" id="rating-count">8</span>
        </div>
      </div>

      <div class="controls">
        <button id="submitBtn" class="primary">Submit rating</button>
        <button id="resetBtn" class="secondary">Change rating</button>
        <div style="flex:1"></div>
        <div class="muted" id="status">You have not submitted yet.</div>
      </div>

      <p class="muted" id="currentInfo">Loading current totals‚Ä¶</p>
    </div>
  </div>

  <!-- Modal -->
  <div id="modal" class="modal">
    <div style="font-size:22px;font-weight:700;margin-bottom:6px" id="modalTitle">Thanks!</div>
    <div class="muted" id="modalText">Your rating has been recorded.</div>
    <div style="height:12px"></div>
    <button id="modalClose" class="primary">Close</button>
  </div>

<script>
(async function(){
  const slider = document.getElementById('slider');
  const bubble = document.getElementById('bubble');
  const peach = bubble.querySelector('.peach');
  const count = document.getElementById('rating-count');
  const submitBtn = document.getElementById('submitBtn');
  const resetBtn = document.getElementById('resetBtn');
  const status = document.getElementById('status');
  const currentInfo = document.getElementById('currentInfo');
  const modal = document.getElementById('modal');
  const modalClose = document.getElementById('modalClose');

  const SUBMITTED_KEY = 'concert_feedback_submitted';
  const SUBMITTED_AT_KEY = 'concert_feedback_submitted_at';

  function getSubmitted() {
    const raw = localStorage.getItem(SUBMITTED_KEY) === 'true';
    const at = localStorage.getItem(SUBMITTED_AT_KEY);
    return { submitted: raw, at: at ? new Date(at) : null };
  }
  function setSubmittedNow() {
    localStorage.setItem(SUBMITTED_KEY, 'true');
    localStorage.setItem(SUBMITTED_AT_KEY, new Date().toISOString());
  }
  function clearSubmittedLocal() {
    localStorage.removeItem(SUBMITTED_KEY);
    localStorage.removeItem(SUBMITTED_AT_KEY);
  }
  function setSubmittedUI(flag) {
    if(flag) {
      status.textContent = 'You already submitted ‚Äî thanks!';
      submitBtn.disabled = true;
      submitBtn.style.opacity = 0.6;
    } else {
      status.textContent = 'You have not submitted yet.';
      submitBtn.disabled = false;
      submitBtn.style.opacity = 1;
    }
  }

  // Dynamic glow + animation
  slider.addEventListener('input', () => {
    const value = Number(slider.value);
    count.textContent = value;
    bubble.className = 'rating-bubble';
    peach.className = 'peach';
    bubble.classList.add(`glow-${value}`);
    peach.classList.add(`glow-${value}`, 'pop');
  });

  async function refreshTotalsAndSyncClient() {
    try {
      const r = await fetch('/api/total');
      if(!r.ok) throw new Error('no totals');
      const data = await r.json();
      const avg = data.totalResponses ? (data.totalRating / data.totalResponses).toFixed(2) : '‚Äî';
      currentInfo.textContent = `Current total points: ${data.totalRating} ‚Ä¢ Responses: ${data.totalResponses} ‚Ä¢ Average: ${avg}`;
      const resetAt = data.resetAt ? new Date(data.resetAt) : null;
      const local = getSubmitted();
      if(local.submitted && local.at && resetAt && local.at < resetAt) {
        clearSubmittedLocal();
        setSubmittedUI(false);
      } else {
        setSubmittedUI(local.submitted);
      }
    } catch (e) {
      currentInfo.textContent = 'Totals unavailable right now.';
    }
  }

  await refreshTotalsAndSyncClient();

  submitBtn.addEventListener('click', async ()=>{
    const rating = Number(slider.value);
    if(rating < 1 || rating > 10) { alert('Please pick a rating between 1 and 10'); return; }
    submitBtn.disabled = true;
    status.textContent = 'Submitting...';
    try{
      const res = await fetch('/api/submit', {
        method:'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ rating })
      });
      if(!res.ok) throw new Error('submit failed');
      setSubmittedNow();
      setSubmittedUI(true);
      await refreshTotalsAndSyncClient();
      document.getElementById('modalTitle').textContent = 'Thank you!';
      document.getElementById('modalText').textContent = `Your rating (${rating}) was recorded.`;
      modal.style.display = 'block';
    }catch(err){
      alert('Could not submit. Please try again.');
      setSubmittedUI(false);
    }
  });

  resetBtn.addEventListener('click', ()=>{
    slider.value = 8;
    count.textContent = 8;
    bubble.className = 'rating-bubble glow-8';
    peach.className = 'peach glow-8';
  });

  modalClose.addEventListener('click', ()=> modal.style.display = 'none');

  setInterval(refreshTotalsAndSyncClient, 5000);
})();
</script>
</body>
</html>
